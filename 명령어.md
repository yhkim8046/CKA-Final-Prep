1. RBAC 관련 예제
매니페스트
# Role 예시 (pods에 대한 권한)
apiVersion: rbac.authorization.k8s.io/v1
kind: Role
metadata:
  namespace: dev-ns
  name: pod-reader
rules:
- apiGroups: [""]
  resources: ["pods"]
  verbs: ["get", "list", "watch"]

---
# RoleBinding 예시
apiVersion: rbac.authorization.k8s.io/v1
kind: RoleBinding
metadata:
  name: read-pods-binding
  namespace: dev-ns
subjects:
- kind: User
  name: john
  apiGroup: rbac.authorization.k8s.io
roleRef:
  kind: Role
  name: pod-reader
  apiGroup: rbac.authorization.k8s.io

명령어
# Role 생성
kubectl create role pod-reader --verb=get,list,watch --resource=pods -n dev-ns

# RoleBinding 생성
kubectl create rolebinding read-pods-binding --role=pod-reader --user=john -n dev-ns

2. Secret 관련 예제
매니페스트
apiVersion: v1
kind: Secret
metadata:
  name: db-secret
  namespace: dev-ns
type: Opaque
data:
  username: YWRtaW4=     # base64(admin)
  password: cGFzc3dvcmQ= # base64(password)

명령어
# Secret 생성 (key=value)
kubectl create secret generic db-secret \
  --from-literal=username=admin \
  --from-literal=password=password \
  -n dev-ns

# Secret 조회
kubectl get secret db-secret -n dev-ns -o yaml
kubectl describe secret db-secret -n dev-ns

3. ConfigMap 관련 예제
매니페스트
apiVersion: v1
kind: ConfigMap
metadata:
  name: app-config
  namespace: dev-ns
data:
  APP_ENV: "production"
  APP_DEBUG: "false"

명령어
# ConfigMap 생성 (key=value)
kubectl create configmap app-config \
  --from-literal=APP_ENV=production \
  --from-literal=APP_DEBUG=false \
  -n dev-ns

# ConfigMap 조회
kubectl get configmap app-config -n dev-ns -o yaml
kubectl describe configmap app-config -n dev-ns

4. Pod에서 활용 예시
apiVersion: v1
kind: Pod
metadata:
  name: demo-pod
  namespace: dev-ns
spec:
  containers:
  - name: app-container
    image: busybox
    command: ["sh", "-c", "env && sleep 3600"]
    envFrom:
    - configMapRef:
        name: app-config
    - secretRef:
        name: db-secret

1. CRD (CustomResourceDefinition)

CRD는 쿠버네티스에 사용자 정의 리소스(Custom Resource) 를 추가하는 방법이에요.
즉, 쿠버네티스에 없는 새로운 오브젝트 타입을 직접 정의하는 것.

CRD 매니페스트 예시
# CRD 정의
apiVersion: apiextensions.k8s.io/v1
kind: CustomResourceDefinition
metadata:
  name: crontabs.stable.example.com
spec:
  group: stable.example.com
  versions:
    - name: v1
      served: true
      storage: true
      schema:
        openAPIV3Schema:
          type: object
          properties:
            spec:
              type: object
              properties:
                cronSpec:
                  type: string
                image:
                  type: string
                replicas:
                  type: integer
  scope: Namespaced
  names:
    plural: crontabs
    singular: crontab
    kind: CronTab
    shortNames:
    - ct

Custom Resource 예시 (위 CRD 사용)
apiVersion: stable.example.com/v1
kind: CronTab
metadata:
  name: my-new-cron
spec:
  cronSpec: "* * * * */5"
  image: my-cron-image
  replicas: 3

명령어 예시
# CRD 생성
kubectl apply -f crd-definition.yaml

# CR 확인
kubectl get crd
kubectl describe crd crontabs.stable.example.com

# Custom Resource 생성
kubectl apply -f my-cron.yaml

# Custom Resource 조회
kubectl get crontabs
kubectl get ct

2. kubectl patch 명령어

kubectl patch 는 리소스를 부분 업데이트할 때 사용해요.
--type 옵션으로 merge, json, strategic 방식을 지정할 수 있습니다.

예제 1: Deployment 레플리카 수 수정 (merge)
kubectl patch deployment my-deploy -p '{"spec": {"replicas": 5}}'

예제 2: Service에 새로운 라벨 추가 (merge)
kubectl patch svc my-service -p '{"metadata": {"labels": {"env": "prod"}}}'

예제 3: json patch (리스트 기반)
kubectl patch deployment my-deploy --type='json' \
  -p='[{"op": "replace", "path": "/spec/replicas", "value": 10}]'

예제 4: strategic merge (컨테이너 이미지 교체)
kubectl patch deployment my-deploy \
  -p='{"spec":{"template":{"spec":{"containers":[{"name":"nginx","image":"nginx:1.25"}]}}}}'

3. CRD + Patch 활용 흐름

예를 들어, 위에서 만든 CronTab CRD 객체를 수정하려면:

kubectl patch crontab my-new-cron \
  --type=merge \
  -p '{"spec": {"replicas": 10}}'

1. ClusterRole 매니페스트 예시
apiVersion: rbac.authorization.k8s.io/v1
kind: ClusterRole
metadata:
  name: pod-admin
rules:
- apiGroups: [""]
  resources: ["pods"]
  verbs: ["get", "list", "watch", "create", "delete"]

ClusterRoleBinding 매니페스트
apiVersion: rbac.authorization.k8s.io/v1
kind: ClusterRoleBinding
metadata:
  name: pod-admin-binding
subjects:
- kind: User
  name: john                # 사용자 이름
  apiGroup: rbac.authorization.k8s.io
roleRef:
  kind: ClusterRole
  name: pod-admin
  apiGroup: rbac.authorization.k8s.io

2. ClusterRole 생성 명령어
# ClusterRole 생성
kubectl create clusterrole pod-admin \
  --verb=get,list,watch,create,delete \
  --resource=pods

# ClusterRoleBinding 생성
kubectl create clusterrolebinding pod-admin-binding \
  --clusterrole=pod-admin \
  --user=john

3. 자주 쓰는 패턴
# 특정 네임스페이스에 접근할 수 있는 ClusterRoleBinding
kubectl create clusterrolebinding read-secrets-global \
  --clusterrole=view \
  --user=jane \
  --namespace=dev-ns

