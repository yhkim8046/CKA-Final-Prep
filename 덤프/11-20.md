Q11

문제:
Node wk8s-node-1에서 kubelet이 관리하는 Static Pod 생성
이미지: httpd
Pod 이름: webtool
매니페스트 경로: /etc/kubernetes/manifests/

해법:

ssh wk8s-node-1
sudo tee /etc/kubernetes/manifests/webtool.yaml <<'EOF'
apiVersion: v1
kind: Pod
metadata:
  name: webtool
  namespace: kube-system
spec:
  containers:
  - name: webtool
    image: httpd
EOF
# kubelet이 자동으로 감지/실행

Q12 〔복원〕

문제:
Deployment cm-app(replicas=1) 생성 후, ConfigMap app-config의 key settings.conf를
컨테이너 /etc/app/settings.conf로 마운트. 이미지 nginx:1.19.

해법:

kubectl create configmap app-config --from-literal=settings.conf="PORT=8080"
cat <<'YAML' > cm-app.yaml
apiVersion: apps/v1
kind: Deployment
metadata:
  name: cm-app
spec:
  replicas: 1
  selector:
    matchLabels: { app: cm-app }
  template:
    metadata:
      labels: { app: cm-app }
    spec:
      containers:
      - name: app
        image: nginx:1.19
        volumeMounts:
        - name: cfg
          mountPath: /etc/app
      volumes:
      - name: cfg
        configMap:
          name: app-config
          items:
          - key: settings.conf
            path: settings.conf
YAML
kubectl apply -f cm-app.yaml

Q13

문제:
라벨 name=cpu-utilizer인 파드 중 CPU 사용률이 가장 높은 파드 이름을
/opt/KUTR00102/KUTR00102.txt에 기록.

해법:

kubectl top pods -l name=cpu-utilizer --no-headers \
  | sort -k2 -nr | head -n1 | awk '{print $1}' > /opt/KUTR00102/KUTR00102.txt

Q14 〔복원〕

문제:
Namespace dev-ns에 Secret db-secret 생성(user=app, password=s3cr3t).
Pod db-client(이미지 busybox)에서 환경변수로 두 값을 노출.

해법:

kubectl create ns dev-ns
kubectl -n dev-ns create secret generic db-secret \
  --from-literal=user=app --from-literal=password=s3cr3t

cat <<'YAML' > db-client.yaml
apiVersion: v1
kind: Pod
metadata:
  name: db-client
  namespace: dev-ns
spec:
  containers:
  - name: c
    image: busybox
    command: ['sh','-c','env; sleep 3600']
    env:
    - name: DB_USER
      valueFrom:
        secretKeyRef: { name: db-secret, key: user }
    - name: DB_PASSWORD
      valueFrom:
        secretKeyRef: { name: db-secret, key: password }
YAML
kubectl apply -f db-client.yaml

Q15

문제:
Pod hungry-bear에 InitContainer 추가.

Init에서 /workdir/calm.txt 생성

메인 컨테이너는 해당 파일 없으면 종료

스펙 파일: /opt/KUCC00108/pod-spec-KUCC00108.yaml

해법(예시 스펙):

apiVersion: v1
kind: Pod
metadata:
  name: hungry-bear
spec:
  volumes:
  - name: workdir
    emptyDir: {}
  initContainers:
  - name: init-calm
    image: busybox
    command: ["sh","-c","mkdir -p /workdir && : > /workdir/calm.txt"]
    volumeMounts:
    - name: workdir
      mountPath: /workdir
  containers:
  - name: main
    image: busybox
    command: ["sh","-c","[ -f /workdir/calm.txt ] || exit 1; sleep 3600"]
    volumeMounts:
    - name: workdir
      mountPath: /workdir

kubectl apply -f /opt/KUCC00108/pod-spec-KUCC00108.yaml

Q16 〔복원〕

문제:
Node worker-1에 taint 추가: key=env, value=prod, effect NoSchedule.
라벨 env=prod를 가진 Pod만 스케줄되도록 테스트.

해법:

kubectl taint nodes worker-1 env=prod:NoSchedule
# 테스트용 Pod
kubectl run test-prod --image=nginx --labels=env=prod \
  --overrides='{"spec":{"nodeSelector":{"kubernetes.io/hostname":"worker-1"}}}' --restart=Never
# 반면 라벨 없는/다른 파드는 스케줄 실패

Q17 〔복원〕

문제:
Namespace logging-ns에 Sidecar 패턴 파드 생성

메인: busybox, 5초마다 /var/log/app/app.log에 “Log entry” 기록

사이드카: busybox, 같은 파일 tail -f로 출력

해법:

apiVersion: v1
kind: Pod
metadata:
  name: logging-deployment
  namespace: logging-ns
spec:
  volumes:
  - name: applog
    emptyDir: {}
  containers:
  - name: app-container
    image: busybox
    command: ['sh','-c','while true; do echo "Log entry" >> /var/log/app/app.log; sleep 5; done']
    volumeMounts:
    - name: applog
      mountPath: /var/log/app
  - name: log-agent
    image: busybox
    command: ['sh','-c','tail -f /var/log/app/app.log']
    volumeMounts:
    - name: applog
      mountPath: /var/log/app

kubectl create ns logging-ns
kubectl apply -f -

Q18 〔복원〕

문제:
모든 PersistentVolume을 용량 기준 내림차순으로 정렬해 /opt/KUCC00102/volume_list_desc에 저장.

해법:

kubectl get pv --sort-by=.spec.capacity.storage -o json \
  | jq '.items | sort_by(.spec.capacity.storage) | reverse' > /opt/KUCC00102/volume_list_desc
# 또는 단순 출력 저장
kubectl get pv -o wide --sort-by=.spec.capacity.storage | tac > /opt/KUCC00102/volume_list_desc

Q19

문제:
Pod nginx-dev 이미지 버전을 jsonpath로 출력.

해법:

kubectl get pod nginx-dev -o jsonpath='{.spec.containers[0].image}{"\n"}'

Q20 〔복원〕

문제:
Deployment nginx-app를 NodePort 30080으로 외부 노출하는 Service nginx-svc 생성(포트 80 → 80).

해법:

# 배포가 없다면 예시 배포
kubectl create deployment nginx-app --image=nginx

# NodePort 서비스
kubectl expose deployment nginx-app --name=nginx-svc --type=NodePort --port=80 --target-port=80

# 포트 30080으로 수정(환경에 따라 포트 범위 30000-32767)
kubectl patch svc nginx-svc -p '{"spec":{"ports":[{"port":80,"targetPort":80,"protocol":"TCP","nodePort":30080}]}}'
kubectl get svc nginx-svc -o wide